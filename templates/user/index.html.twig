 {# ? Partie : Gestion des utilisateurs #ModeAdmin #}

 {% extends 'base.html.twig' %}
     
     {% block metaTitle %}
         " Gestion des utilisateurs "
     {% endblock %}

     {% block title %}
         Gestion des utilisateurs
     {% endblock %}
     
     {% block body %}

         <main class="Form"> 

             <div class="text-center col-12">

                 <section>
    
                     <h1> Gestion des utilisateurs </h1>
         
                     <hr/>

                         <p> 
                             <em> Consulter la liste des utlisateurs de votre site et administrer leurs droits. </em>  üìá 
                         </p>

                     <hr/>

                 </section>
                 
                 {# ? Partie: Barre de recherche User #}

                 <h6> <kbd> Barre de recherche par filtre en cours d'int√©gration: Work In Progress ‚ö†Ô∏è </kbd> </h6>
                 <input type="text" id="myInput" onkeyup="myFunction()" placeholder="Entrer un mot cl√© pour effectuer une recherche rapide...">

                 <article>
    
                     <table id="myTable" class="table table-dark table-hover">

                         <thead>

                             <tr class="header">
                                 <th> Id </th>
                                 <th> Pseudo </th>
                                 <th> Roles </th>
                                 <th> Mot de passe </th>
                                 <th> Avatar </th>
                                 <th> Email </th>
                                 <th> Actions </th>
                             </tr>

                         </thead>

                         {# ! todo: La fonction " Barre de recherche ne fonctionne pas encore. #}
                         {# ! Je voudrais int√©grer une barre de recherche > qui appplique un filtre sur nos champs #}
                         {# !  Table filtre > Source: https://www.w3schools.com/howto/howto_js_filter_table.asp #}

                         <script>

                                 function myFunction() {

                                     // Declare variables
                                     var input, filter, table, tr, th, i, txtValue;
                                     input = document.getElementById("myInput");
                                     filter = input.value.toUpperCase();
                                     table = document.getElementById("myTable");
                                     tr = table.getElementsByTagName("tr");
                                 
                                     // Loop through all table rows, and hide those who don't match the search query
                                     for (i = 0; i < tr.length; i++) {

                                         th = tr[i].getElementsByTagName("th")[0];

                                         if (th) {

                                             txtValue = th.textContent || th.innerText;

                                             if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                                 tr[i].style.display = "";
                                             } 
                                             
                                             else {
                                                 tr[i].style.display = "none";
                                             }

                                         }

                                     }


                                 }

                         </script>
                         
                         <tbody>

                         {% for user in users %}

                             <tr>

                                 <td> {{ user.id }} </td>
                                 <td> {{ user.login }} </td>

                                 <td>

                                     {% autoescape false %} 
                                         {{user.roles|json_encode() ? user.roles|json_encode|replace({',':', <br/>', 'ROLE_USER':'User', 'ROLE_ADMIN':'Admin', '[':'','"':'',']':''}) : ''}}
                                     {% endautoescape %}
                                 
                                 </td>
                            
                                 {# <td> {{ user.password }} </td> #}
                                 <td> {{ user.password |length > 10 ? user.password |slice(0,10)~'...' : user.password }} </td>


                                 <td> {{ user.avatar ? 'oui' : 'non' }} </td>
                                 <td> {{ user.email }} </td>

                                 <td>
                                
                                     <section class="btn-group">

                                         <a href="{{ path('user_show', {'id': user.id}) }}" type="submit" class="btn btn-success btn-lg col-12">                                
                                             Voir
                                         </a>  
    
                                         <a href="{{ path('user_edit', {'id': user.id}) }}" type="submit" class="btn btn-success btn-lg col-12">                                
                                             Modifier
                                         </a>   

                                     </section>    

                                 </td>

                             </tr>

                             {% else %}

                                 <tr>
                                     <td colspan="7"> Aucun √©l√©ment ne correspond √† votre recherche </td>
                                 </tr>

                             {% endfor %}

                         </tbody>

                     </table>

                 </article>

                 <hr/>

                 <section class="btn-group-vertical col-12">

                     <a href="{{ path('user_new') }}" class="btn btn-dark col-12 btn-lg px-4 gap-3">
                         Cr√©er un nouvel utilisateur
                     </a>

                     <a href="{{ path('interface_administration') }}" class="btn btn-success col-12 btn-lg px-4 gap-3">
                         Retour √† l'interface d'administration
                     </a>

                 </section>    

             <div/>      

         </main>

     {% endblock %}
     

     {# https://openclassrooms.com/fr/courses/1603881-apprenez-a-creer-votre-site-web-avec-html5-et-css3/1607171-creez-des-formulaires #}